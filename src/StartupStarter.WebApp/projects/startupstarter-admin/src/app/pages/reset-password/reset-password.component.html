<div class="reset-password">
  <mat-card class="reset-password__card">
    <mat-card-header>
      <mat-card-title>Reset Password</mat-card-title>
      <mat-card-subtitle>Enter your new password</mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      @if (successMessage()) {
        <div class="reset-password__success-message">
          <mat-icon>check_circle</mat-icon>
          {{ successMessage() }}
        </div>
        <a mat-flat-button color="primary" routerLink="/login" class="reset-password__login-btn">
          Go to Login
        </a>
      } @else {
        @if (errorMessage()) {
          <div class="reset-password__error-message">{{ errorMessage() }}</div>
        }

        <form [formGroup]="form" (ngSubmit)="onSubmit()">
          <mat-form-field appearance="outline" class="reset-password__field">
            <mat-label>New Password</mat-label>
            <input matInput [type]="hidePassword() ? 'password' : 'text'" formControlName="newPassword">
            <button mat-icon-button matSuffix type="button" (click)="togglePassword()">
              <mat-icon>{{ hidePassword() ? 'visibility_off' : 'visibility' }}</mat-icon>
            </button>
            @if (form.get('newPassword')?.hasError('required')) {
              <mat-error>Password is required</mat-error>
            }
            @if (form.get('newPassword')?.hasError('minlength')) {
              <mat-error>Password must be at least 8 characters</mat-error>
            }
            @if (form.get('newPassword')?.hasError('pattern')) {
              <mat-error>Password must contain uppercase, lowercase, number, and special character</mat-error>
            }
          </mat-form-field>

          <mat-form-field appearance="outline" class="reset-password__field">
            <mat-label>Confirm Password</mat-label>
            <input matInput [type]="hideConfirmPassword() ? 'password' : 'text'" formControlName="confirmPassword">
            <button mat-icon-button matSuffix type="button" (click)="toggleConfirmPassword()">
              <mat-icon>{{ hideConfirmPassword() ? 'visibility_off' : 'visibility' }}</mat-icon>
            </button>
            @if (form.get('confirmPassword')?.hasError('required')) {
              <mat-error>Please confirm your password</mat-error>
            }
            @if (form.hasError('passwordMismatch')) {
              <mat-error>Passwords do not match</mat-error>
            }
          </mat-form-field>

          <button mat-flat-button color="primary" type="submit" class="reset-password__submit-btn"
                  [disabled]="isLoading() || form.invalid">
            @if (isLoading()) {
              <mat-spinner diameter="20"></mat-spinner>
            } @else {
              Reset Password
            }
          </button>
        </form>
      }
    </mat-card-content>

    @if (!successMessage()) {
      <mat-card-actions class="reset-password__actions">
        <a mat-button routerLink="/login">Back to Login</a>
      </mat-card-actions>
    }
  </mat-card>
</div>
