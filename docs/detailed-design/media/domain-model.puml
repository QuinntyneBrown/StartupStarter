@startuml Media Domain Model

!define AGGREGATE_ROOT_COLOR #FFEBCD
!define ENTITY_COLOR #E6F3FF
!define VALUE_OBJECT_COLOR #E6FFE6
!define ENUM_COLOR #FFE6E6

' Aggregate Root
class Media <<Aggregate Root>> AGGREGATE_ROOT_COLOR {
  + MediaId: Guid
  + FileName: string
  + FileType: FileType
  + FileSize: long
  + StorageLocation: string
  + ContentType: string?
  + Width: int?
  + Height: int?
  + Duration: TimeSpan?
  + UploadedBy: Guid
  + AccountId: Guid
  + ProfileId: Guid?
  + IsProcessed: bool
  + ProcessedAt: DateTime?
  + UploadedAt: DateTime
  + UpdatedAt: DateTime?
  + DeletedAt: DateTime?
  + IsDeleted: bool
  + DownloadCount: int
  --
  + {static} Create(...): Media
  + Update(updatedFields, updatedBy): void
  + MarkAsProcessed(...): void
  + AddTags(tags, taggedBy): void
  + RemoveTag(tagName): void
  + AssignCategories(categories, categorizedBy): void
  + RemoveCategory(categoryName): void
  + IncrementDownloadCount(downloadedBy): void
  + Delete(deletedBy, deletionType): void
}

' Entities
class MediaTag <<Entity>> ENTITY_COLOR {
  + TagId: Guid
  + MediaId: Guid
  + TagName: string
  + TaggedBy: Guid
  + TaggedAt: DateTime
  --
  + {static} Create(mediaId, tagName, taggedBy): MediaTag
}

class MediaCategory <<Entity>> ENTITY_COLOR {
  + CategoryId: Guid
  + MediaId: Guid
  + CategoryName: string
  + CategorizedBy: Guid
  + CategorizedAt: DateTime
  --
  + {static} Create(mediaId, categoryName, categorizedBy): MediaCategory
}

class ProcessedMediaVersion <<Entity>> ENTITY_COLOR {
  + VersionId: Guid
  + MediaId: Guid
  + ProcessingType: ProcessingType
  + OutputFormat: string
  + StorageLocation: string
  + FileSize: long
  + Width: int?
  + Height: int?
  + Bitrate: int?
  + CreatedAt: DateTime
  --
  + {static} Create(...): ProcessedMediaVersion
}

' Enumerations
enum FileType ENUM_COLOR {
  Image
  Video
  Audio
  Document
  Other
}

enum ProcessingType ENUM_COLOR {
  None
  ImageResize
  ImageOptimization
  VideoTranscode
  VideoThumbnail
  AudioTranscode
  DocumentConversion
}

enum DeletionType ENUM_COLOR {
  SoftDelete
  HardDelete
}

' Domain Events
class MediaUploadedDomainEvent <<Domain Event>> VALUE_OBJECT_COLOR {
  + MediaId: Guid
  + FileName: string
  + FileType: string
  + FileSize: long
  + UploadedBy: Guid
  + AccountId: Guid
  + ProfileId: Guid?
  + StorageLocation: string
  + EventId: Guid
  + OccurredAt: DateTime
}

class MediaUpdatedDomainEvent <<Domain Event>> VALUE_OBJECT_COLOR {
  + MediaId: Guid
  + AccountId: Guid
  + UpdatedBy: Guid
  + UpdatedFields: Dictionary<string, object>
  + EventId: Guid
  + OccurredAt: DateTime
}

class MediaDeletedDomainEvent <<Domain Event>> VALUE_OBJECT_COLOR {
  + MediaId: Guid
  + FileName: string
  + AccountId: Guid
  + DeletedBy: Guid
  + DeletionType: DeletionType
  + EventId: Guid
  + OccurredAt: DateTime
}

class MediaDownloadedDomainEvent <<Domain Event>> VALUE_OBJECT_COLOR {
  + MediaId: Guid
  + AccountId: Guid
  + DownloadedBy: Guid
  + EventId: Guid
  + OccurredAt: DateTime
}

class MediaProcessedDomainEvent <<Domain Event>> VALUE_OBJECT_COLOR {
  + MediaId: Guid
  + AccountId: Guid
  + ProcessingType: string
  + OutputFormats: List<string>
  + ProcessingDuration: TimeSpan
  + EventId: Guid
  + OccurredAt: DateTime
}

class MediaTaggedDomainEvent <<Domain Event>> VALUE_OBJECT_COLOR {
  + MediaId: Guid
  + AccountId: Guid
  + Tags: List<string>
  + TaggedBy: Guid
  + EventId: Guid
  + OccurredAt: DateTime
}

class MediaCategorizedDomainEvent <<Domain Event>> VALUE_OBJECT_COLOR {
  + MediaId: Guid
  + AccountId: Guid
  + Categories: List<string>
  + CategorizedBy: Guid
  + EventId: Guid
  + OccurredAt: DateTime
}

' External References
class User <<External>> {
  + UserId: Guid
  + Name: string
}

class Account <<External>> {
  + AccountId: Guid
  + Name: string
}

class Profile <<External>> {
  + ProfileId: Guid
  + Name: string
}

' Relationships - Aggregate composition
Media "1" *-- "0..*" MediaTag: contains
Media "1" *-- "0..*" MediaCategory: contains
Media "1" *-- "0..*" ProcessedMediaVersion: contains

' Relationships - Enums
Media --> FileType: has
ProcessedMediaVersion --> ProcessingType: has
MediaDeletedDomainEvent --> DeletionType: references

' Relationships - Domain Events
Media ..> MediaUploadedDomainEvent: raises
Media ..> MediaUpdatedDomainEvent: raises
Media ..> MediaDeletedDomainEvent: raises
Media ..> MediaDownloadedDomainEvent: raises
Media ..> MediaProcessedDomainEvent: raises
Media ..> MediaTaggedDomainEvent: raises
Media ..> MediaCategorizedDomainEvent: raises

' Relationships - External references
Media --> User: UploadedBy
MediaTag --> User: TaggedBy
MediaCategory --> User: CategorizedBy
Media --> Account: belongs to
Media --> Profile: optional association

note right of Media
  **Aggregate Root**
  - Ensures invariants for all media operations
  - Manages tags and categories
  - Tracks processing status
  - Controls access through domain events
end note

note right of ProcessedMediaVersion
  **Processed Version**
  - Stores different formats/sizes
  - Created during media processing
  - Enables multi-format delivery
end note

note bottom of FileType
  **File Types**
  Determines how media
  is processed and stored
end note

@enduml
