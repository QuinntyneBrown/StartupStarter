@startuml
title Account Management - Query Account Flow

actor User
participant "API Gateway" as API
participant "QueryController" as Controller
participant "MediatR ISender" as MediatR
participant "GetAccountByIdHandler" as Handler
participant "AccountReadModel" as ReadModel
database "Read DB" as ReadDB

User -> API: GET /api/accounts/{id}
activate API

API -> Controller: GetAccountByIdQuery(id)
activate Controller

Controller -> MediatR: Send(query)
activate MediatR

MediatR -> Handler: Handle(query)
activate Handler

Handler -> Handler: Validate query

note right of Handler
  Check ID format
  Validate permissions
end note

Handler -> ReadModel: GetById(accountId)
activate ReadModel

ReadModel -> ReadDB: SELECT * FROM Accounts WHERE Id = @id
activate ReadDB

ReadDB --> ReadModel: Account data
deactivate ReadDB

ReadModel -> ReadModel: Map to DTO

note right of ReadModel
  Transform to API response format
end note

ReadModel --> Handler: AccountDto
deactivate ReadModel

Handler --> MediatR: QueryResult<AccountDto>
deactivate Handler

MediatR --> Controller: Result
deactivate MediatR

Controller --> API: 200 OK (AccountDto)
deactivate Controller

API --> User: Account details
deactivate API

note over User, ReadDB
  Query Benefits:
  Fast read from optimized DB
  No domain logic needed
  Simple data access
  Can have multiple read models
  Denormalized for performance
end note

@enduml
