@startuml
title Account Management - Domain Model (Event Sourced)

skinparam linetype ortho
skinparam classAttributeIconSize 0

package "Account Aggregate" {
    
    enum AccountType {
        Enterprise
        Team
        Individual
    }
    
    enum AccountStatus {
        Active
        Suspended
        Deleted
    }
    
    enum DeletionType {
        SoftDelete
        HardDelete
    }
    
    class Account <<Aggregate Root>> {
        - accountId: AccountId
        - accountName: string
        - accountType: AccountType
        - ownerUserId: UserId
        - subscriptionTier: string
        - status: AccountStatus
        - settings: AccountSettings
        - profileIds: List<ProfileId>
        - version: long
        - uncommittedEvents: List<DomainEvent>
        __
        + Create(id, name, type, ownerId, tier, createdBy): Account
        + Update(fields, updatedBy): void
        + Delete(deletionType, deletedBy): void
        + Suspend(reason, duration, suspendedBy): void
        + Reactivate(reactivatedBy): void
        + ChangeSubscription(newTier, changedBy, effectiveDate): void
        + ChangeOwner(newOwnerId, transferredBy): void
        + UpdateSettings(category, settings, updatedBy): void
        + AddProfile(profileId, profileName, createdBy): void
        + RemoveProfile(profileId, removedBy): void
        __
        + GetUncommittedEvents(): List<DomainEvent>
        + MarkEventsAsCommitted(): void
        + LoadFromHistory(events): Account
        - Apply(event): void
        __
        - ValidateAccountType(): void
        - ValidateOwnerChange(): void
        - ValidateSubscriptionChange(): void
        - EnsureNotDeleted(): void
        - EnsureNotSuspended(): void
    }
    
    class AccountId <<Value Object>> {
        - value: string
        __
        + NewId(): AccountId
        + From(value): AccountId
        + ToString(): string
        + Equals(other): bool
    }
    
    class UserId <<Value Object>> {
        - value: string
        __
        + From(value): UserId
        + ToString(): string
        + Equals(other): bool
    }
    
    class ProfileId <<Value Object>> {
        - value: string
        __
        + From(value): ProfileId
        + ToString(): string
        + Equals(other): bool
    }
    
    class AccountSettings <<Value Object>> {
        - settings: Dictionary<string, object>
        __
        + GetSetting(category, key): object
        + UpdateCategory(category, values): AccountSettings
        + ToJson(): string
    }
    
    Account "1" *-- "1" AccountId
    Account "1" *-- "1" UserId
    Account "1" *-- "0..*" ProfileId
    Account "1" *-- "1" AccountSettings
    Account ..> AccountType
    Account ..> AccountStatus
    Account ..> DeletionType
}

package "Domain Events" {
    
    abstract class DomainEvent {
        + eventId: string
        + aggregateId: string
        + timestamp: DateTime
        + version: long
    }
    
    class AccountCreated {
        + accountId: string
        + accountName: string
        + accountType: AccountType
        + ownerUserId: string
        + subscriptionTier: string
        + createdBy: string
    }
    
    class AccountUpdated {
        + accountId: string
        + updatedBy: string
        + updatedFields: Dictionary
        + previousValues: Dictionary
    }
    
    class AccountDeleted {
        + accountId: string
        + accountName: string
        + ownerUserId: string
        + deletedBy: string
        + userCount: int
        + profileCount: int
        + contentCount: int
        + deletionType: DeletionType
    }
    
    class AccountSuspended {
        + accountId: string
        + suspendedBy: string
        + reason: string
        + suspensionDuration: TimeSpan
        + affectedUserCount: int
        + affectedProfileCount: int
    }
    
    class AccountReactivated {
        + accountId: string
        + reactivatedBy: string
    }
    
    class AccountSubscriptionChanged {
        + accountId: string
        + previousTier: string
        + newTier: string
        + changedBy: string
        + effectiveDate: DateTime
    }
    
    class AccountOwnerChanged {
        + accountId: string
        + previousOwnerUserId: string
        + newOwnerUserId: string
        + transferredBy: string
    }
    
    class AccountSettingsUpdated {
        + accountId: string
        + settingCategory: string
        + updatedSettings: Dictionary
        + updatedBy: string
    }
    
    class AccountProfileAdded {
        + accountId: string
        + profileId: string
        + profileName: string
        + createdBy: string
    }
    
    class AccountProfileRemoved {
        + accountId: string
        + profileId: string
        + profileName: string
        + removedBy: string
    }
    
    DomainEvent <|-- AccountCreated
    DomainEvent <|-- AccountUpdated
    DomainEvent <|-- AccountDeleted
    DomainEvent <|-- AccountSuspended
    DomainEvent <|-- AccountReactivated
    DomainEvent <|-- AccountSubscriptionChanged
    DomainEvent <|-- AccountOwnerChanged
    DomainEvent <|-- AccountSettingsUpdated
    DomainEvent <|-- AccountProfileAdded
    DomainEvent <|-- AccountProfileRemoved
    
    Account ..> DomainEvent
}

note right of Account
  Event Sourcing Pattern
  State rebuilt from events
  All changes produce events
  Events are immutable
  Version for optimistic locking
end note

note right of DomainEvent
  Events are Facts
  Past tense naming
  Immutable once published
  Complete audit trail
  Source of truth
end note

@enduml
